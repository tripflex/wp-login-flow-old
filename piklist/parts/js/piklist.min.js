(function(c,e,g,a){c(g).ready(function(){c("body").piklistgroups().piklistcolumns().piklistmediaupload().piklistaddmore({sortable:true}).piklistfields();c(".meta-box-sortables, div.widgets-sortables").on("sortstart",function(j,k){if(c(this).is(".meta-box-sortables, div.widgets-sortables")){c(this).find(".wp-editor-area").each(function(){if(typeof switchEditors!="undefined"){var l=c(this).attr("id");switchEditors.go(l,"tmce");tinyMCE.execCommand("mceRemoveControl",false,l)}})}}).on("sortstop",function(j,k){if(c(this).is(".meta-box-sortables, div.widgets-sortables")){c(this).find(".wp-editor-area").each(function(){if(typeof switchEditors!="undefined"){var l=c(this).attr("id");tinyMCE.execCommand("mceAddControl",true,c(this).attr("id"))}})}})});var i=function(k,j){this.$element=c(k);this._init()};i.prototype={constructor:i,processed_conditions:[],_init:function(){if(typeof piklist_fields!="undefined"){this.fields()}},fields:function(){for(var j in piklist_fields){this.process_fields(j)}},process_fields:function(n){var k=this.to_array(piklist_fields[n]);for(var m in k){for(var l in k[m]){if(!k[m][l].display){this.process_field(k[m][l],n)}}}},to_array:function(j){return c.map(j,function(k){return[c.map(k,function(l){return l})]})},process_field:function(q,k){if(q.id&&q.id.indexOf("__i__")>-1){var m=c('input[value="'+k+'"]:last').parents(".widget").attr("id"),j=m.charAt(m.length-1);if(!isNaN(parseFloat(j))&&isFinite(j)){q.id=q.id.toString().replace("__i__",j);q.name=q.name.toString().replace("__i__",j)}else{return false}}if(q.conditions){var s,p,r;for(var l in q.conditions){p=typeof q.conditions[l].type=="undefined"?"toggle":q.conditions[l].type;if(!this.processed_conditions[p]){this.processed_conditions[p]=[]}switch(p){case"update":var t=q,o="#"+q.conditions[l].id,r=q.name;c(':input[name="'+q.name+'"]').on("input propertychange change",{selector:o,condition:q.conditions[l]},this.conditions_handler);c(':input:not(:radio)[name="'+q.name+'"], :radio:checked[name="'+q.name+'"]').trigger("input propertychange change");this.processed_conditions[p].push(q.name);break;default:o='[name="'+q.name+'"]';r=o+":"+q.conditions[l].id;if(c.inArray(r,this.processed_conditions[p])==-1){c("."+q.conditions[l].id).on("input propertychange change",{selector:o,condition:q.conditions[l]},this.conditions_handler);c(':input:not(:radio)[class~="'+q.conditions[l].id+'"], :radio:checked[class~="'+q.conditions[l].id+'"]').trigger("change");this.processed_conditions[p].push(r)}break}}}var u=typeof q.options==="object"?q.options:null;switch(q.type){case"editor":c('textarea[name="'+q.name+'"]').each(function(){var x=c(this).attr("id");if(typeof x=="undefined"){var w=c(this).attr("data-piklist-original-id"),n=c(this).attr("name"),v=c(this).parents(".wp-editor-wrap:first");x=Math.random().toString(36).substr(2,9)+"piklisteditor"+n.replace(/[^A-Z0-9]/g,"");v.css("height",v.height()+"px").empty();c.ajax({type:"POST",url:ajaxurl,async:false,data:{action:"piklist_form",method:"field",field:{type:q.type,field:q.field,scope:q.scope,options:q.options,required:q.required,prefix:q.prefix,template:"field",embed:true,id:x}},success:function(y){y=c.parseJSON(y);c(y.field).insertAfter(v);v.remove();tinyMCEPreInit.mceInit[x]=tinyMCEPreInit.mceInit[w];tinyMCEPreInit.mceInit[x].elements=x;tinyMCEPreInit.qtInit[x]=tinyMCEPreInit.mceInit[w];tinyMCEPreInit.qtInit[x].id=x;quicktags({id:x});tinyMCE.execCommand("mceAddControl",false,x);var z=tinyMCE.get(x);z.focus()}})}else{if(typeof tinyMCEPreInit.qtInit[x]=="undefined"){for(w in tinyMCEPreInit.qtInit){if(w.substr(w.indexOf("piklisteditor")+("piklisteditor").length)==x.substr(x.indexOf("piklisteditor")+("piklisteditor").length)){tinyMCEPreInit.mceInit[x]=tinyMCEPreInit.mceInit[w];tinyMCEPreInit.mceInit[x].elements=x;tinyMCEPreInit.qtInit[x]=tinyMCEPreInit.mceInit[w];tinyMCEPreInit.qtInit[x].id=x;break}}quicktags({id:x});tinyMCE.execCommand("mceAddControl",false,x)}}});break;case"datepicker":c(':input[name="'+q.name+'"]').each(function(){if(!c(this).hasClass("hasDatepicker")){c(this).attr("autocomplete","off").datepicker(u)}});break;case"colorpicker":c(':input[name="'+q.name+'"]').each(function(){c(this).addClass("has-wp-color-picker").wpColorPicker(u)});break}if(q.js_callback){e[q.js_callback](q)}},conditions_handler:function(j){var m=j.data.selector,k=j.data.condition,p=c(this).index(':input[name="'+c(this).attr("name")+'"]'),l=m.replace(/\[[0-9]+(?!.*[0-9])\]/,"["+p+"]"),r;if(m==l){r=c(m+":eq("+p+")");if(r.length==0){r=c(m)}}else{r=c(l)}switch(k.type){case"update":if((c(this).val()==k.value||k.value==":any")||k.force){if(r.is(":radio")||r.is(":checkbox")){if(c(this).val()==""){r.removeAttr("checked")}else{r.attr("checked","checked")}}else{r.val(k.update)}}break;default:var q=c(this).parents("form").find(':input[name="option_page"]').length>0,t=q?"tr":".piklist-field-condition",n=c(this).prop("tagName")=="LABEL"?c(this).find(":input"):this,s={position:"relative",left:"auto"},o={position:"absolute",left:"-9999999px"};if(c(this).parents("div[data-piklist-field-group]").length>0){t="div[data-piklist-field-group]"}else{if(c(this).parents("div[data-piklist-field-columns]").length>0){t="div[data-piklist-field-columns]"}}if(c(n).val()==k.value&&!c(n).is(":checkbox")){if(r.hasClass("piklist-field-condition")){r.css(s)}else{r.parents(t).css(s)}}else{if(c(n).val()==k.value&&c(n).is(":checkbox")&&c(n).is(":checked")){if(r.hasClass("piklist-field-condition")){r.css(s)}else{r.parents(t).css(s)}}else{if(typeof k.reset=="undefined"||!k.reset){if(r.is(":radio")||r.is(":checkbox")){r.attr("checked",false)}else{r.val("")}}if(c(n).is(":input")){if(r.hasClass("piklist-field-condition")){r.css(o)}else{r.parents(t).css(o)}}}}break}return false}};c.fn.piklistfields=function(j){var k=Array.apply(null,arguments);k.shift();return this.each(function(){var n=c(this),m=n.data("piklistfields"),l=typeof j==="object"&&j;if(!m){n.data("piklistfields",(m=new i(this,c.extend({},c.fn.piklistfields.defaults,l,c(this).data()))))}if(typeof j==="string"){m[j].apply(m,k)}})};c.fn.piklistfields.defaults={};c.fn.piklistfields.Constructor=i;var f=function(k,j){this.$element=c(k);this._init()};f.prototype={constructor:f,_init:function(){this.$element.find("*[data-piklist-field-group]:not(:radio, :checkbox)").each(function(){var j=c(this),l=j.data("piklist-field-group"),k=j.data("piklist-field-sub-group");j.siblings('label[for="'+j.attr("name")+'"]:first, span.piklist-list-item-label').addBack().wrapAll('<div data-piklist-field-group="'+l+'" '+(k?'data-piklist-field-sub-group="'+k+'"':"")+" />")});this.$element.find("*[data-piklist-field-group]").filter(":radio, :checkbox").each(function(){var j=c(this),o=j.data("piklist-field-group"),k=j.data("piklist-field-sub-group"),n=j.parents(".piklist-field-list").length>0,p=n?".piklist-field-list":".piklist-field-list-item",m=j.parents("div[data-piklist-field-group]:eq(0)"),l=c('<div data-piklist-field-group="'+o+'" '+(k?'data-piklist-field-sub-group="'+k+'"':"")+" />");if(m.length>0){m.attr("data-piklist-field-group",o);if(k){m.attr("data-piklist-field-sub-group",k)}}else{l.css("display",n?"block":"inline-block");j.parents(p).siblings('.piklist-label[for="'+j.attr("name")+'"]:first').addBack().wrapAll(l)}})}};c.fn.piklistgroups=function(j){var k=Array.apply(null,arguments);k.shift();return this.each(function(){var n=c(this),m=n.data("piklistgroups"),l=typeof j==="object"&&j;if(!m){n.data("piklistgroups",(m=new f(this,c.extend({},c.fn.piklistgroups.defaults,l,c(this).data()))))}if(typeof j==="string"){m[j].apply(m,k)}})};c.fn.piklistgroups.defaults={};c.fn.piklistgroups.Constructor=f;var h=function(k,j){this.$element=c(k);this.add=j.add;this.remove=j.remove;this.move=j.move;this.sortable=j.sortable;this._init()};h.prototype={constructor:h,templates:[],_init:function(){var j=this;c(g).on("click","[data-piklist-field-addmore-action]",{piklistaddmore:j},j.action_handler);this.$element.find('*[data-piklist-field-addmore="true"]').each(function(){var l=c(this),p=l.attr("data-piklist-field-group"),r=l.attr("name"),n=c("<div />").attr("data-piklist-field-addmore",r).addClass("piklist-field-addmore-wrapper"),m=c("<div />").addClass("piklist-field-addmore-wrapper-actions").css("display","inline");if(l.is("[data-piklist-field-columns]")){n.css({"float":"none"})}if(l.is(":checkbox, :radio")){var o=c(':input[name="'+l.attr("name")+'"]').commonAncestor();if(o.parent('div[data-piklist-field-addmore="'+l.attr("name")+'"]').length==0){o.wrapAll(n)}}else{if(l.hasClass("wp-editor-area")){n.addClass("piklist-field-addmore-wrapper-full");l.parents(".wp-editor-wrap:first").wrapAll(n)}else{if(typeof p==="undefined"){l.siblings('label[for="'+l.attr("name")+'"], .piklist-field-preview, .piklist-label-container').addBack().wrapAll(n)}else{var r=c('div[data-piklist-field-group="'+p+'"], div[data-piklist-field-sub-group="'+p+'"]');l=r.last();r=c.merge(r,c(r.last()));r.wrapAll(n)}}}var q=l.parents("div[data-piklist-field-addmore"+(typeof r=="string"?'="'+r+'"':"")+"]:first"),o=q.parent();if(q.find('[data-piklist-field-addmore-actions="false"]').length==0){if(q.height()>=70){m.addClass("piklist-field-addmore-wrapper-actions-vertical");q.addClass("piklist-field-addmore-wrapper-vertical")}m.prepend(c(j.add).attr("data-piklist-field-addmore-action","add"));m.prepend(c(j.remove).attr("data-piklist-field-addmore-action","remove"))}else{q.addClass("piklist-field-sortable")}if(j.sortable){if(!o.hasClass("ui-sortable")){o.sortable({items:"> div[data-piklist-field-addmore]",cursor:"move",start:function(s,t){c(this).find(".wp-editor-area").each(function(){if(typeof switchEditors!="undefined"){var u=c(this).attr("id");switchEditors.go(u,"tmce");tinyMCE.execCommand("mceRemoveControl",false,u)}})},stop:function(s,t){c(this).find(".wp-editor-area").each(function(){if(typeof switchEditors!="undefined"){var u=c(this).attr("id");tinyMCE.execCommand("mceAddControl",true,u)}})}})}}var k=l.parent("div.piklist-field-addmore-wrapper").children('div[data-piklist-field-group="'+p+'"]:last');if(k.length>0){m.insertAfter(k)}else{if(l.hasClass("wp-editor-area")){l=l.parents(".wp-editor-wrap:first")}m.insertAfter(l)}});this.$element.find(":input[data-piklist-field-addmore]").each(function(){var l=c(this),k=l.parents("div[data-piklist-field-addmore]:first"),m=k.attr("data-piklist-field-addmore"),n=[],o="[data-piklist-field-addmore], .piklist-field-addmore-wrapper-actions, .piklist-field-addmore-wrapper, .piklist-field-column";if(typeof m!="undefined"){k=c("<div/>").append(k.parent().html());k.find("div[data-piklist-field-addmore]").each(function(){var p=c(this).attr("data-piklist-field-addmore");if(c.inArray(p,n)==-1){c(this).find(":input").each(function(){c(this).attr("data-piklist-original-id",c(this).attr("id")).removeAttr("id").removeAttr("checked").off().find("option").removeAttr("selected");if(!c(this).is(":checkbox, :radio")){c(this).removeAttr("value")}});if(!c(this).prev().is(o)){c(this).prev().remove()}if(!c(this).next().is(o)){c(this).next().remove()}c(this).find(".piklist-field-preview").remove();if(c(this).children("*:nth-last-child(2)").height()<45&&c(this).children("div[data-piklist-field-addmore]").length==0&&c(this).children().length<5){c(this).removeClass("piklist-field-addmore-wrapper-vertical").find(".piklist-field-addmore-wrapper-actions-vertical").removeClass("piklist-field-addmore-wrapper-actions-vertical")}n.push(p)}else{c(this).remove()}});k.children().each(function(){if(!c(this).is('.piklist-field-addmore-wrapper-actions, [data-piklist-field-addmore="'+m+'"]')){c(this).remove()}});j.templates[m]=k.html()}})},action_handler:function(l){l.preventDefault();if(l.isPropagationStopped()){return}l.stopPropagation();var v=c(this),p=v.parents("div.piklist-field-addmore-wrapper:first"),q=p.siblings("div.piklist-field-addmore-wrapper").length,o=p.attr("data-piklist-field-addmore"),t=o?o.replace(/\]/g,"").split("["):[],m=0,r=l.data.piklistaddmore;for(var n=t.length-1;n>=0;n--){if(c.isNumeric(t[n])){m=m+1}}switch(v.attr("data-piklist-field-addmore-action")){case"add":var k=p.attr("data-piklist-field-addmore"),u=r.templates[k],s=c(u).find('div[data-piklist-field-addmore="'+k+'"]:first');if(s.length>0){u=c(s).clone().wrap("<div>").parent().html()}c(u).insertAfter(p);p.parent().children("div.piklist-field-addmore-wrapper").each(function(j){c(this).find(":input").each(function(){var z=c(this).attr("name"),C=c(this).parents(".widget-content").length>0;if(z){var y=z.replace(/\]/g,"").split("["),B=y[0],A=c(this).parents("div[data-piklist-field-addmore]:last"),x=A.index('div[data-piklist-field-addmore="'+A.attr("data-piklist-field-addmore")+'"]');for(var w=0;w<y.length;w++){if(c.isNumeric(y[w])){if(!C){y[w]=x}C=false}y[w]=y[w]+(B!==y[w]?"]":"")}c(this).attr("name",y.join("["));c('*[for="'+z+'"]').attr("for",y.join("["))}});c(this).sortable({items:"> div[data-piklist-field-addmore]",cursor:"move",start:function(w,x){c(this).find(".wp-editor-area").each(function(){if(typeof switchEditors!="undefined"){var y=c(this).attr("id");switchEditors.go(y,"tmce");tinyMCE.execCommand("mceRemoveControl",false,y)}})},stop:function(w,x){c(this).find(".wp-editor-area").each(function(){if(typeof switchEditors!="undefined"){var y=c(this).attr("id");tinyMCE.execCommand("mceAddControl",true,y)}})}})}).piklistfields();break;case"remove":if(q>0){p.remove()}break}}};c.fn.piklistaddmore=function(j){var k=Array.apply(null,arguments);k.shift();return this.each(function(){var n=c(this),m=n.data("piklistaddmore"),l=typeof j==="object"&&j;if(!m){n.data("piklistaddmore",(m=new h(this,c.extend({},c.fn.piklistaddmore.defaults,l,c(this).data()))))}if(typeof j==="string"){m[j].apply(m,k)}})};c.fn.piklistaddmore.defaults={add:'<a href="#" class="button button-primary piklist-add-more-add">+</a>',remove:'<a href="#" class="button button-secondary piklist-add-more-remove">&ndash;</a>',move:'<span class="piklist-add-more-move">&varr;</span>',sortable:false};c.fn.piklistaddmore.Constructor=h;var d=function(k,j){this.$element=c(k);this.total_columns=j.total_columns;this.column_width=j.column_width;this.gutter_width=j.gutter_width;this.gutter_height=j.gutter_height;this.minimum_height=j.minimum_height;this._init()};d.prototype={constructor:d,_init:function(){var m=this.total_columns,o=this.column_width,l=this.gutter_width,n=this.gutter_height,j=this.minimum_height,k={columns:0,gutters:0,group:false};this.$element.find("*[data-piklist-field-columns]:not(:radio, :checkbox)").each(function(){var p=c(this),q=p.data("piklist-field-columns"),r=p.parent("div[data-piklist-field-group]:eq(0)");if(r.length>0){r.attr("data-piklist-field-columns",q)}else{p.siblings('label[for="'+p.attr("name")+'"]:first').addBack().wrapAll('<div data-piklist-field-columns="'+q+'" />')}p.css({width:p.attr("size")||p.is(":button, :submit")?"auto":"100%"}).parent("div[data-piklist-field-columns]").css({display:"block","float":"left",width:(q*o+(q-1)*l)+"%","margin-left":l+(c.isNumeric(l)?"%":null),"margin-bottom":n+(c.isNumeric(n)?"%":null)})});this.$element.find("*[data-piklist-field-columns]").filter(":radio, :checkbox").each(function(){var p=c(this),r=p.data("piklist-field-columns"),s=p.data("piklist-field-group"),q=p.data("piklist-field-sub-group"),t=p.parents(".piklist-field-list").length>0?".piklist-field-list":".piklist-field-list-item";p.parents(t).each(function(){if(c(this).parent("div[data-piklist-field-columns]").length==0){var u=c(this).parent("div[data-piklist-field-group]:eq(0)");if(u.length>0){u.attr("data-piklist-field-columns",r)}else{c(this).siblings('.piklist-label[for="'+p.attr("name")+'"]:first').addBack().wrapAll('<div data-piklist-field-columns="'+r+'" data-piklist-field-group="'+s+'" '+(q?'data-piklist-field-sub-group="'+q+'"':"")+" />")}c(this).parent("div[data-piklist-field-columns]").css({display:"block","float":"left",width:(r*o+(r-1)*l)+"%","margin-left":l+(c.isNumeric(l)?"%":null),"margin-bottom":n+(c.isNumeric(n)?"%":null)})}})});this.$element.find("div[data-piklist-field-columns]").each(function(r){var p=c(this),q=p.data("piklist-field-columns"),s=p.data("piklist-field-group");p.addClass("piklist-field-column");if(typeof k.group=="undefined"||k.group!=s){k={columns:0,gutters:0,group:s}}if(k.columns==0){p.addClass("piklist-field-column-first").css({"margin-left":"0"})}k={columns:k.columns+q,gutters:k.gutters+1,group:s};if(k.columns>=m){p.addClass("piklist-field-column-last");k={columns:0,gutters:0,group:false}}});this.$element.find(".piklist-field-column-first").each(function(){var r=c(this).nextUntil(".piklist-field-column-last").addBack(),q=r.add(r.last().next()),p=0;q.each(function(s){if(c(this).height()>p){p=c(this).height()}});q.css("min-height",p)})}};c.fn.piklistcolumns=function(j){var k=Array.apply(null,arguments);k.shift();return this.each(function(){var n=c(this),m=n.data("piklistcolumns"),l=typeof j==="object"&&j;if(!m){n.data("piklistcolumns",(m=new d(this,c.extend({},c.fn.piklistcolumns.defaults,l,c(this).data()))))}if(typeof j==="string"){m[j].apply(m,k)}})};c.fn.piklistcolumns.defaults={total_columns:12,column_width:6,gutter_width:2.54,gutter_height:"7px"};c.fn.piklistcolumns.Constructor=d;var b=function(k,j){this.$element=c(k);this._init()};b.prototype={constructor:b,_init:function(){var j;c(".piklist-upload-file-preview .attachments").sortable({items:"li.attachment",cursor:"move",update:function(n,o){var k=c(this).find("[data-attachment-id]"),q=c(k[0]).data("attachments"),l=c(':input[name="'+q+'"]'),p=[];k.each(function(r){p.push(c(this).data("attachment-id"))});c(':input[name="'+q+'"]:not(:first)').remove();l.val(p.shift());for(var m=0;m<p.length;m++){c(l.first().clone().removeAttr("id").val(p[m])).insertAfter(c(':input[name="'+q+'"]:last'))}}});c(".piklist-upload-file-preview .attachment").on("click",function(k){k.preventDefault();c(this).parents(".piklist-upload-file-preview:first").prev(".piklist-upload-file-button").trigger("click")});c(".piklist-upload-file-preview .attachment .check").on("click",function(m){m.preventDefault();var l=c(c(this).parents(".attachment:first")).index(c(this).parents("attachments:first")),k=c(this).data("attachments"),n=c(this).data("attachment-id");if(c(':input[name="'+k+'"]').length==1){c(':input[name="'+k+'"][value="'+n+'"]:eq('+l+")").val("")}else{c(':input[name="'+k+'"][value="'+n+'"]:eq('+l+")").remove()}c(this).parents(".attachment:first").remove()});c(".piklist-upload-file-button").on("click",function(l){l.preventDefault();var k=c(this);if(j){j.open();return}j=wp.media.frames.file_frame=wp.media({title:k.attr("title"),button:{text:k.text()},multiple:true});j.on("select",function(){var m=j.state().get("selection"),n=k.next(".piklist-upload-file-preview").children(':input[type="hidden"]'),r=n.attr("name"),q=k.next(".piklist-upload-file-preview").find("ul.attachments"),p=[];m.map(function(t){t=t.toJSON();if(t.sizes){var s=t.sizes.full;if(t.sizes.thumbnail){s=t.sizes.thumbnail}else{if(t.sizes.medium){s=t.sizes.medium}else{if(t.sizes.large){s=t.sizes.large}}}q.append(c('<li class="attachment selected">                      <div class="attachment-preview '+(s.width>s.height?"landscape":"portrait")+'">                        <div class="thumbnail">                          <div class="centered">                            <a href="#">                             <img src="'+s.url+'" />                           </a>                          </div>                        </div>                        <a class="check" href="#" title="Deselect" data-attachment-id="'+t.id+'" data-attachments="'+n.attr("name")+'"><div class="media-modal-icon"></div></a>                      </div>                   </li>                 '))}else{var s=t;q.append(c('<li class="attachment selected">                      <div class="attachment-preview type-'+s.type+" subtype-"+s.subtype+' landscape">                        <img src="'+s.icon+'" class="icon" />                        <div class="filename">                          <div>'+s.filename+'</div>                        </div>                        <a class="check" href="#" title="Deselect" data-attachment-id="'+t.id+'" data-attachments="'+n.attr("name")+'"><div class="media-modal-icon"></div></a>                      </div>                   </li>                 '))}p.push(t.id)});for(var o=0;o<p.length;o++){c(n.first().clone().removeAttr("id").val(p[o])).insertAfter(c(':input[name="'+r+'"]:last'))}});j.open()})}};c.fn.piklistmediaupload=function(j){var k=Array.apply(null,arguments);k.shift();return this.each(function(){var n=c(this),m=n.data("piklistmediaupload"),l=typeof j==="object"&&j;if(!m){n.data("piklistmediaupload",(m=new b(this,c.extend({},c.fn.piklistmediaupload.defaults,l,c(this).data()))))}if(typeof j==="string"){m[j].apply(m,k)}})};c.fn.piklistmediaupload.defaults={};c.fn.piklistmediaupload.Constructor=b})(jQuery,window,document);jQuery.fn.reverse=function(){return Array.prototype.reverse.call(this)};jQuery.fn.commonAncestor=function(){var e=null,d=this.eq(0).parents().reverse(),a=d.length-1;for(var c=1,b=this.length;c<b&&a>0;c+=1){e=this.eq(c).parents().reverse();a=Math.min(a,e.length-1);while(d[a]!==e[a]){a-=1}}return d.eq(a)};